<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Seismic Full Waveform Inversion · Toolbox for Geophysical Inversion</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Toolbox for Geophysical Inversion</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../born_map/">Seismic Born Modeling</a></li><li class="current"><a class="toctext" href>Seismic Full Waveform Inversion</a><ul class="internal"></ul></li><li><a class="toctext" href="../../Poisson/adj_state_expt/">Poisson Solver</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Seismic Full Waveform Inversion</a></li></ul><a class="edit-page" href="https://github.com/TRAVIS_REPO_SLUG/blob/master/"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Seismic Full Waveform Inversion</span><a class="fa fa-bars" href="#"></a></div></header><pre><code class="language-">model = J.Gallery.Seismic(:acou_homo2);
J.Models.Seismic_addon!(model,randn_perc=1, fields=[:χvp,:χρ])

model0 = J.Gallery.Seismic(:acou_homo2);
J.Models.Seismic_addon!(model0, randn_perc=1, fields=[:χvp,:χρ])

acqgeom=J.Acquisition.Geom_fixed(model,1,10)
acqsrc=J.Acquisition.Src_fixed_mod(acqgeom.nss,1,[:P],mod=model, nλ=3, tmaxfrac=1.0)
tgrid=acqsrc.tgrid

parameterization=[:χvp, :χρ, :null]

mgrid=model.mgrid

@testset &quot;test parallel implementation during gradient&quot; begin
	for attrib_mod in [JF.ModFdtd(), JF.ModFdtdBorn()]
		pa=JF.Param(acqsrc, acqgeom, tgrid, attrib_mod, model0,
				     modm_obs=model,
				     modm0=model0,
				     igrid_interp_scheme=:B2,
				     igrid=broadcast(x-&gt;range(x[1],stop=x[end],step=300.),mgrid),
				     parameterization=parameterization,   verbose=false,
				     nworker=1)


		pa_parallel=JF.Param(acqsrc, acqgeom, tgrid, attrib_mod, model0,
				     modm_obs=model,
				     modm0=model0,
				     igrid_interp_scheme=:B2,
				     igrid=broadcast(x-&gt;range(x[1],stop=x[end],step=300.),mgrid),
				     parameterization=parameterization,   verbose=false,
				     nworker=nothing)

		result=JF.xfwi!(pa, JF.Migr(), attrib_mod)

		result_parallel=JF.xfwi!(pa_parallel, JF.Migr(), attrib_mod)

		@test result[2] ≈ result_parallel[2]
	end
end

@testset &quot;Testing Born Modeling and its gradient&quot; begin

	pa=JF.Param(acqsrc, acqgeom, tgrid, JF.ModFdtdBorn(), model0,
	     		     modm0=model0,
			     modm_obs=model,
			     igrid_interp_scheme=:B2,
			     igrid=broadcast(x-&gt;range(x[1],stop=x[end],step=350.),mgrid),
			     parameterization=parameterization,   verbose=false)


	JF.xfwi!(pa, JF.LS(), JF.ModFdtdBorn(),  bounded_flag=true, solver=:ipopt,
			ipopt_options=[[&quot;max_iter&quot;, 0],[&quot;derivative_test&quot;, &quot;first-order&quot;]])

	result=JF.xfwi!(pa, JF.Migr(), JF.ModFdtdBorn())

	pa_fd=deepcopy(pa);
	result_fd=JF.xfwi!(pa_fd, JF.Migr_fd(), JF.ModFdtdBorn())

	f=Misfits.error_squared_euclidean!(nothing, result[2], result_fd[2], nothing, norm_flag=true)

	@test f&lt;1e-15
end

@testset &quot;Testing gradient LS FWI&quot; begin
	pa=JF.Param(acqsrc, acqgeom, tgrid, JF.ModFdtd(), model0,
			     modm_obs=model,
			     igrid_interp_scheme=:B2,
			     igrid=broadcast(x-&gt;range(x[1],stop=x[end],step=350.),mgrid),
			     parameterization=parameterization,   verbose=false)

	JF.xfwi!(pa, JF.LS(), JF.ModFdtd(),  bounded_flag=true, solver=:ipopt,
			ipopt_options=[[&quot;max_iter&quot;, 0],[&quot;derivative_test&quot;, &quot;first-order&quot;]])


	result=JF.xfwi!(pa, JF.Migr(), JF.ModFdtd())

	pa_fd=deepcopy(pa);
	result_fd=JF.xfwi!(pa_fd, JF.Migr_fd(), JF.ModFdtd())

	f=Misfits.error_squared_euclidean!(nothing, result[2], result_fd[2], nothing, norm_flag=true)

	@test f&lt;1e-15
end</code></pre><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../born_map/"><span class="direction">Previous</span><span class="title">Seismic Born Modeling</span></a><a class="next" href="../../Poisson/adj_state_expt/"><span class="direction">Next</span><span class="title">Poisson Solver</span></a></footer></article></body></html>
