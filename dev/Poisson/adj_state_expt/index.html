<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Poisson Solver · Toolbox for Geophysical Inversion</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Toolbox for Geophysical Inversion</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../../FWI/born_map/">Seismic Born Modeling</a></li><li><a class="toctext" href="../../FWI/gradient_accuracy/">Seismic Full Waveform Inversion</a></li><li class="current"><a class="toctext" href>Poisson Solver</a><ul class="internal"></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Poisson Solver</a></li></ul><a class="edit-page" href="https://github.com/TRAVIS_REPO_SLUG/blob/master/"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Poisson Solver</span><a class="fa fa-bars" href="#"></a></div></header><p>This module represents an explicit, direct sparse 2D finite-difference Poisson solver for heterogeneous media, i.e. media having spatially varying (space-dependent) medium parameters. The following functionality is currently available in this module:</p><ul><li>Apply operator <span>$A=∇⋅(σ(x,z)∇)$</span> on a field <span>$ψ$</span>.</li><li>Apply <span>$A^{-1}$</span> in order to solve for <span>$ψ$</span> in <span>$Aψ=p$</span>, given <span>$p$</span>.</li></ul><p>Current implementation assumes Neumann boundary conditions at all the boundaries.</p><p>As a demo, start with loading some packages.</p><pre><code class="language-">using SparseArrays
using StatsBase
using LinearAlgebra
using Random
using ProgressMeter
using LinearAlgebra
using Test
using ForwardDiff
using Calculus</code></pre><p>Dimensions and spatial grids are allocated as follows.</p><div><pre><code class="language-julia">nx=20
nz=20
nt=4
nznx=nz*nx
mgrid=[range(0.0,step=0.5, length=nz), range(0.0,step=0.5, length=nz)]
tgrid=range(0.0,step=0.5, length=nt)

p=randn(nznx+1)
p[end]=0.0
Qv=abs.(randn(nz,nx))
η=abs.(randn(nz,nx))
k=abs.(randn(nz,nx))
σ=abs.(randn(nz,nx))
σobs=abs.(randn(nz,nx))
Qobs=abs.(randn(nz,nx))
psi0=randn(nznx)

snaps=randn(nz,nx,nt)</code></pre><pre><code class="language-none">20×20×4 Array{Float64,3}:
[:, :, 1] =
 -0.298668   -1.33514     0.430046   …  -0.150002   0.964087     0.561746
 -0.576959    0.588831    1.35415        1.06273   -0.397        1.94411
 -0.312252    2.01666    -0.87847       -1.14476    0.106378     0.162324
 -1.00569    -0.276429    0.420019       0.611884  -0.202399     1.77305
  0.396525    1.3554     -1.1024         0.203415   0.248571     0.583917
 -0.908053    0.824816   -1.0769     …  -1.14648   -0.832532     2.68517
  0.125338    1.38928     0.321006       1.08288    0.172404     0.882403
  0.932463   -0.105271   -0.75313        0.779876  -0.291242    -0.517473
 -1.03792    -1.12226     1.13312       -0.424177  -0.105687    -0.565587
 -1.36245    -1.27774    -0.19959        0.834432   0.78481      1.52011
  0.238553    1.26176    -0.191919   …   1.14137   -2.12545      0.92943
  0.79094    -0.290365   -1.27422       -0.318657   0.286985     0.231452
  0.0477666   2.81932     0.0893774     -1.15497   -0.0295195    0.611277
  1.12903     1.57526    -0.540914      -1.61857   -0.424379     0.57377
 -0.797928   -0.858748    0.170456      -1.28882   -0.00661794  -1.03572
  0.037393    0.754071   -0.846299   …  -0.638503  -0.0377735   -1.69608
 -1.16628    -0.0333751  -0.58184       -1.20816    1.03761     -1.05104
  0.522326    1.30942     0.356404       0.027583  -1.78659     -0.480581
  1.32367     0.335869    0.946026      -1.94231   -1.33813     -0.941938
 -0.834541   -0.854364    0.496899      -0.878781  -1.69569      0.593369

[:, :, 2] =
  2.10777     1.46174      0.760674   …  -0.378021   1.12139      0.115183
  1.20953    -0.396313    -0.535486       0.390284   1.51799     -0.223122
 -1.00582    -1.6682      -0.120908       0.555107  -0.791885    -0.0827947
 -2.03402     1.01171      0.830788       0.914213  -0.761314     1.12365
 -1.9572      0.0936949    0.23229       -1.15121    1.157        1.45764
  1.62908     2.29688      0.203765   …  -2.29564    1.39638     -1.80491
  2.02882    -0.503468     0.5305        -0.953911  -1.09731     -0.316789
 -0.549326    0.936148    -0.405689      -0.918117  -0.271471     0.980345
 -0.0187168  -0.306027     1.16563        1.71325    0.182422    -1.14624
  0.500225   -1.73712     -1.73805        0.370409  -0.367271     0.639446
 -0.0918217  -1.54755     -0.331484   …  -0.421152  -0.891615     0.91668
 -1.0614     -0.474332    -1.38476        1.64499   -0.279774     0.00752387
 -0.189562    1.25884      1.70079       -1.53153   -0.563154    -1.45627
 -0.440497   -0.454408     0.472737       0.641661   0.428882    -0.00763038
 -0.566936   -0.194776    -0.47532        0.167072   0.316053     0.832328
 -0.809252   -0.156054    -0.799842   …   0.20838   -0.0195489   -2.45938
  0.920481    0.232051     0.0191225      0.430624  -0.640548    -0.712825
 -3.34297     0.118727     2.80706       -0.494693   0.305161    -0.435805
 -0.614891   -0.74185     -0.681322      -0.166348  -0.922031     0.359299
 -0.602638    0.00462619   0.131173       0.814364   0.00618914   0.181104

[:, :, 3] =
 -1.37624    -0.921526    0.990587   …  -1.11492      1.03863     0.551141
  0.408321   -0.18685     0.576063      -0.876471    -0.0803101  -0.137952
  0.207727    1.26713     0.0876043      0.0301665   -0.0152519  -1.66373
  0.478038    0.183715   -0.384578      -2.19059     -0.175271   -0.12558
 -0.911127    0.291229    0.200932      -0.627519    -0.421954    0.238559
 -1.74566    -0.0877227   0.197094   …   0.619464    -0.332723    0.372552
 -0.582945    1.29587    -0.806166       1.38594      0.478979    0.187015
  0.468487    0.828002   -1.52529       -0.434832     0.326943   -0.124438
  0.144452   -0.970764   -0.709206      -0.495285    -0.640524    0.568685
 -0.523665   -0.364972   -0.360128      -1.03023      0.117925   -0.0900478
  1.03966    -0.125173   -1.91326    …  -0.0743411    1.0629      0.0276134
 -0.655487   -0.41583     0.206851      -1.49701     -0.383151    0.614794
 -0.75519     0.960439   -2.58173       -0.387987    -0.796573   -0.0481648
  0.0588586   0.581162    0.395744      -0.906173    -1.63125     0.45896
 -0.380116    0.300274   -1.31224        0.00367012   0.55968    -0.0125093
 -1.0721     -0.0701732  -0.59501    …   0.993048    -0.0613637  -0.288828
 -0.932991    0.424325    0.556001       0.606155     0.0254635  -2.30276
  0.312207    1.57417     1.83506       -0.388819     0.0504469  -0.0485544
  1.01813     0.535375    0.266853       0.520761     1.05289    -0.765259
  0.865411   -0.0236191  -0.269589      -0.279077    -1.97267     0.315268

[:, :, 4] =
 -0.48677     1.11638    1.91397    …   1.44838    -0.596139    -1.33218
 -1.11792     0.372558  -0.777559       0.0852022   1.09892     -0.953692
  0.588588    0.880705  -1.32515        0.217961    0.805012     0.0935534
 -1.58229    -1.22228   -0.254026      -1.26372    -0.405938    -1.04678
 -0.660997    0.574071   0.712556       0.118948    0.280874     1.56509
  1.07444     1.61224    1.2863     …   0.242889    0.0376695    0.0742807
  1.57592     0.410752   0.361221       1.22293     2.05924     -0.0826068
  0.0845648  -1.31646   -1.16312        1.49865     0.00485585   1.35372
 -1.46059     0.90446   -0.670182       0.0413734  -0.583642    -1.87827
  0.271601    0.405688  -0.157493       0.365453    0.111901     0.434577
 -0.841141   -0.323897  -2.20712    …   0.836295   -0.197322    -0.684499
 -1.94579    -0.98111    0.9653         0.515928    0.949815     0.212037
 -0.311868    0.609759  -0.779533       0.0280302   0.379783    -1.88194
 -0.736353   -0.836033  -0.601974      -0.541225   -0.89736      0.474577
  0.331537   -1.28386   -0.0424459      0.637746    0.49038     -0.454079
  0.0388074  -0.466764   0.389823   …   0.363271   -0.150826     0.665083
 -0.296819    0.133085  -0.505392       0.695785    1.08916     -1.6856
 -1.64408    -1.03112    0.6405        -0.918602   -0.498258    -1.05356
 -1.42576    -0.99139    1.11661        1.24972     1.28019     -0.0154977
 -0.241859   -0.677647   0.310827       0.648892    0.320178     0.191887</code></pre></div><p>Generate the parameters for the Poisson experiment.</p><pre><code class="language-">paE=J.Poisson.ParamExpt(snaps, tgrid, mgrid, Qv, k, η, σ, σobs=σobs, Qobs=Qobs)</code></pre><pre><code class="language-">J.Poisson.updateLP!(paE, paE.Q)</code></pre><p>Calculate the data misfit.</p><pre><code class="language-">@time f=J.Poisson.func(σ,paE)</code></pre><p>Compute the gradient with finite-difference approximation.</p><pre><code class="language-">f = x-&gt;J.Poisson.func(x, paE);
gcalc = Calculus.gradient(f);
g_fd=reshape(gcalc(vec(σ)),nz,nx);</code></pre><p>Compute the gradient using adjoint state method.</p><pre><code class="language-">@time J.Poisson.mod!(paE,σ,J.Poisson.FGσ())
g=paE.g;</code></pre><p>Check gradient accuracy.</p><pre><code class="language-">@test ≈(g,g_fd, rtol=1e-5)</code></pre><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><footer><hr/><a class="previous" href="../../FWI/gradient_accuracy/"><span class="direction">Previous</span><span class="title">Seismic Full Waveform Inversion</span></a></footer></article></body></html>
